pipeline {
  stages {
    stage('Create Packer AMI') {
        steps {
        {
            sh 'packer build packer/ami.json'
        }
      }
    }
    stage('AWS Deployment') {
      steps {
      {
            sh '''
               cd node-app-terraform
               terraform init
               terraform apply -auto-approve -var access_key=${AWS_KEY} -var secret_key=${AWS_SECRET}
            '''
        }
      }
    }
  }
}